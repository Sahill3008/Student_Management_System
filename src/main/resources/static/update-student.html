<!DOCTYPE html>
<html>
<head>
    <title>Update Student</title>
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>

<h2>Update Student</h2>

<select id="studentSelect" onchange="loadDetails()"></select>

<input id="name" placeholder="New Name"><br>
<input id="email" placeholder="New Email"><br>
<input id="age" placeholder="New Age" type="number"><br>

<button onclick="updateStudent()">Update</button>

<script>
    async function loadList() {
        const res = await fetch("/students");
        const data = await res.json();

        const select = document.getElementById("studentSelect");
        data.content.forEach(s => {
            let opt = document.createElement("option");
            opt.value = s.id;
            opt.text = s.name;
            select.add(opt);
        });
    }

    async function loadDetails() {
        const id = document.getElementById("studentSelect").value;
        if (!id) return;

        const res = await fetch(`/students/${id}`);
        const s = await res.json();

        document.getElementById("name").value = s.name;
        document.getElementById("email").value = s.email;
        document.getElementById("age").value = s.age;
    }

    async function updateStudent() {
        const id = document.getElementById("studentSelect").value;

        const body = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            age: parseInt(document.getElementById("age").value)
        };

        const res = await fetch(`/students/${id}`, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(body)
        });

        if (res.ok) alert("Updated!");
        else alert("Update failed");
    }

    loadList();
</script>

</body>
</html>
