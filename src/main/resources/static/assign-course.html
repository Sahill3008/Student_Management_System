<!DOCTYPE html>
<html>
<head>
    <title>Assign Course to Student</title>
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>

<h2>Assign Course to a Student</h2>

<select id="studentSelect">
    <option value="">Select Student</option>
</select>

<select id="courseSelect">
    <option value="">Select Course</option>
</select>

<button onclick="assign()">Assign Course</button>

<script>
    // Load students into dropdown
    async function loadStudents() {
        const res = await fetch("/students");
        const data = await res.json();
        const select = document.getElementById("studentSelect");

        data.content.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.id;
            opt.textContent = s.name + " (" + s.email + ")";
            select.appendChild(opt);
        });
    }

    // Load courses into dropdown
    async function loadCourses() {
        const res = await fetch("/courses");
        const courses = await res.json();
        const select = document.getElementById("courseSelect");

        courses.forEach(c => {
            const opt = document.createElement("option");
            opt.value = c.id;
            opt.textContent = c.courseName;
            select.appendChild(opt);
        });
    }

    // Assign course to student
    async function assign() {
        const studentId = document.getElementById("studentSelect").value;
        const courseId = document.getElementById("courseSelect").value;

        if (!studentId || !courseId) {
            alert("Please select both student and course!");
            return;
        }

        const res = await fetch(`/students/${studentId}/courses/${courseId}`, {
            method: "POST"
        });

        if (res.ok) {
            alert("Course assigned successfully!");
        } else {
            const err = await res.json();
            alert("Error: " + err.message);
        }
    }

    // Load data on page load
    loadStudents();
    loadCourses();
</script>

</body>
</html>
